<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sorpresa Sol</title>

  <style>
    :root{
      --bg1:#14001f;
      --bg2:#2a0037;
      --card:#120018cc;
      --stroke:#ffffff22;
      --text:#fff;
      --muted:#ffffffb3;
      --yes:#ff4d88;
      --yes2:#ff7ab2;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --radius: 22px;

      /* Ajusta a 64px si estÃ¡s en CodePen Full View, 0px para tu sitio */
      --ui-top: 0px;

      /* Ribbon config */
      --ribbon-angle: -35deg;
      --ribbon-speed: 16s;
      --photo-h: clamp(62px, 7.5vw, 90px);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      overflow:hidden;
      background:
        radial-gradient(1200px 800px at 20% 20%, #ff3b9b33, transparent 60%),
        radial-gradient(900px 700px at 80% 30%, #8a2be233, transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
    }

    #app{
      height:100%;
      display:grid;
      place-items:center;
      padding:24px;
    }

    .card{
      width:min(560px, 92vw);
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:26px 22px 22px;
      position:relative;
      backdrop-filter: blur(10px);
      z-index:15;
    }

    .badge{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid var(--stroke);
      color:var(--muted);
      font-size:14px;
      margin-bottom:10px;
    }

    h1{
      margin:8px 0 10px;
      font-size: clamp(26px, 3.6vw, 38px);
      line-height:1.1;
    }

    .sub{
      margin:0 0 18px;
      color:var(--muted);
      font-size: clamp(15px, 2.2vw, 17px);
    }

    .buttons{
      display:flex;
      gap:14px;
      align-items:center;
      margin-top:10px;
      flex-wrap:wrap;
    }

    .btn{
      border:none;
      border-radius:16px;
      padding:14px 18px;
      font-size:18px;
      cursor:pointer;
      user-select:none;
      touch-action: manipulation;
      transition: transform .15s ease, filter .15s ease;
    }

    .btn:active{transform: scale(.98);}

    .btn.yes{
      background: linear-gradient(135deg, var(--yes), var(--yes2));
      color:#fff;
      box-shadow: 0 12px 28px rgba(255,77,136,.25);
      transform-origin:center;
    }
    .btn.yes:hover{filter:brightness(1.05);}

    .btn.no{
      white-space: nowrap;
      width: max-content;
      max-width: none;
      background: #ffffff18;
      color:#fff;
      border:1px solid var(--stroke);
      position: fixed;
      z-index: 30;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .btn.ghost{
      background:#ffffff12;
      border:1px solid var(--stroke);
      color:#fff;
    }

    .hint{
      margin:16px 0 0;
      font-size:14px;
      color:#ffffffa8;
    }

    .hidden{display:none !important;}

    /* ===== Hearts ===== */
    #hearts{position:fixed; inset:0; pointer-events:none; overflow:hidden; z-index:20;}
    .heart{
      position:fixed;
      bottom:-70px;
      left:0;
      width:40px;
      height:40px;
      background-repeat:no-repeat;
      background-size:contain;
      background-position:center;
      opacity:.95;
      pointer-events:none;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.35));
      animation: floatUp linear forwards;
    }
    @keyframes floatUp{
      to{
        transform: translate(var(--drift, 0px), calc(-1 * (100vh + 80px))) rotate(var(--rot, 0deg));
        opacity:0;
      }
    }

    /* ===== Strip opcional ===== */
    .strip{
      margin:16px 0 18px;
      border:1px solid var(--stroke);
      border-radius:18px;
      overflow:hidden;
      background:#ffffff10;
    }
    .strip .track{
      display:flex;
      gap:12px;
      padding:12px;
      width:max-content;
      animation: marquee 22s linear infinite;
    }
    .strip img{
      width:110px;
      height:78px;
      object-fit:cover;
      border-radius:14px;
      border:1px solid #ffffff22;
    }
    @keyframes marquee{
      from{transform: translateX(0);}
      to{transform: translateX(-50%);}
    }

    /* ===== Toast ===== */
    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform:translateX(-50%);
      padding:10px 14px;
      border-radius:999px;
      background:#00000055;
      border:1px solid #ffffff22;
      color:#fff;
      font-size:14px;
      opacity:0;
      pointer-events:none;
      transition: opacity .2s ease;
      z-index:40;
    }
    .toast.show{opacity:1;}

    /* ===== RIBBON DIAGONAL (esquinas) ===== */
    .ribbon-diag{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:14;
      overflow:hidden;
    }
    .ribbon-diag.hidden{
      display:none !important;
    }

    .ribbon-diag .diag{
      position:absolute;
      overflow:visible;
    }

    /* Top-left corner */
    .ribbon-diag .diag.tl{
      left: 240px;
      top: calc(var(--ui-top) + 160px); /* âœ… FIX: faltaba el + */
    }

    /* Bottom-right corner */
    .ribbon-diag .diag.br{
      right: 240px;
      bottom: 160px;
    }

    .ribbon-diag .track{
      position:absolute;
      display:flex;
      align-items:center;
      gap:12px;
      width:max-content;
      will-change: transform;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.35));
    }

    .ribbon-diag .diag.tl .track{
      transform-origin: 0 0;
      transform: rotate(var(--ribbon-angle));
      animation: ribbonMove var(--ribbon-speed) linear infinite;
    }

    .ribbon-diag .diag.br .track{
      transform-origin: 0 0;
      transform: rotate(var(--ribbon-angle));
      animation: ribbonMove var(--ribbon-speed) linear infinite reverse;
    }

    .ribbon-diag img{
      height: var(--photo-h);
      width: auto;
      aspect-ratio: 4 / 3;
      object-fit: cover;
      border-radius: 18px;
      display: block;
      border: 2px solid rgba(255,255,255,0.15);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    @keyframes ribbonMove{
      from{ transform: rotate(var(--ribbon-angle)) translateX(0); }
      to{ transform: rotate(var(--ribbon-angle)) translateX(-50%); }
    }

    @media (max-width: 768px){
      :root{ --photo-h: clamp(48px, 9vw, 70px); }
      .ribbon-diag .track{ gap: 10px; }
    }

    @media (prefers-reduced-motion: reduce){
      .heart{animation:none}
      .strip .track{animation:none}
      .ribbon-diag .track{animation:none}
      .btn{transition:none}
    }
  </style>
</head>

<body>
  <div id="app">
    <main class="card" id="stage-question" aria-live="polite">
      <!-- SIN botÃ³n No aquÃ­ -->
      <div class="badge">ðŸ’Œ San ValentÃ­n</div>
      <h1 id="title">Â¿querÃ©s ser mi Valentine? ðŸ’˜</h1>
      <p class="sub" id="subtitle">A pesar de estar lejos una vez mÃ¡s :(</p>

      <div class="buttons">
        <button id="yesBtn" class="btn yes">Sii ðŸ’–</button>
      </div>

      <p class="hint" id="hint"></p>
    </main>

    <main class="card hidden" id="stage-yes">
      <h1 id="yayTitle">YAAAY</h1>
      <p class="sub" id="yaySub">Te amo infinito hermosa, gracias por todoðŸ’ž</p>

      <div id="photoStrip" class="strip hidden" aria-hidden="true"></div>

      <button id="restartBtn" class="btn ghost">Pensar la respuesta otra vez</button>
    </main>

    <div id="hearts" aria-hidden="true"></div>
    <div id="toast" class="toast" aria-live="polite"></div>

    <!-- âœ… El botÃ³n No va AQUÃ -->
    <button id="noBtn" class="btn no" type="button">No (soy re mala)</button>
  </div>

  <!-- Ribbon diagonal -->
  <div id="ribbonDiag" class="ribbon-diag hidden" aria-hidden="true">
    <div class="diag tl">
      <div class="track" id="ribbonTL"></div>
    </div>
    <div class="diag br">
      <div class="track" id="ribbonBR"></div>
    </div>
  </div>

  <script>
    // ====== CONFIG ======
    const PHOTO_URLS = Array.from({ length: 10 }, (_, i) =>
      `https://raw.githubusercontent.com/Santichucho/Imagenes-corazon/main/photos/${i + 1}.jpg`
    );

    const HEART_IMG_URLS = [
      "https://raw.githubusercontent.com/Santichucho/Imagenes-corazon/main/heart_sketch_1.png",
      "https://raw.githubusercontent.com/Santichucho/Imagenes-corazon/main/heart_sketch_2.png",
      "https://raw.githubusercontent.com/Santichucho/Imagenes-corazon/main/heart_sketch_3.png",
      "https://raw.githubusercontent.com/Santichucho/Imagenes-corazon/main/heart_sketch_4.png",
    ];

    const STRIP_URLS = [];
    const DEBUG = false; // âœ… ponelo en false para producciÃ³n
    // ====================

    document.addEventListener("DOMContentLoaded", () => {
      const yesBtn = document.getElementById("yesBtn");
      const noBtn = document.getElementById("noBtn");
      const stageQ = document.getElementById("stage-question");
      const stageY = document.getElementById("stage-yes");
      const heartsLayer = document.getElementById("hearts");
      const toast = document.getElementById("toast");
      const photoStrip = document.getElementById("photoStrip");
      const restartBtn = document.getElementById("restartBtn");
      const ribbonDiag = document.getElementById("ribbonDiag");
      const ribbonTL = document.getElementById("ribbonTL");
      const ribbonBR = document.getElementById("ribbonBR");

      const requiredCore = { yesBtn, noBtn, stageQ, stageY, heartsLayer, toast, restartBtn };
      for (const [k, v] of Object.entries(requiredCore)) {
        if (!v) {
          console.error(`Falta elemento core: ${k}. RevisÃ¡ ids en el HTML.`);
          return;
        }
      }

      let heartTimer = null;
      let noAttempts = 0;

      function log(...args) {
        if (DEBUG) console.log('[Valentine]', ...args);
      }

      function showToast(msg) {
        toast.textContent = msg;
        toast.classList.add("show");
        clearTimeout(showToast._t);
        showToast._t = setTimeout(() => toast.classList.remove("show"), 1400);
      }

      function growYesButton() {
        noAttempts++;
        const scale = 1 + (noAttempts * 0.08);
        yesBtn.style.transform = `scale(${scale})`;
        yesBtn.style.transition = "transform 0.3s ease";
        log(`Yes button scale: ${scale} (attempts: ${noAttempts})`);
      }

      function resetYesButton() {
        noAttempts = 0;
        yesBtn.style.transform = "scale(1)";
        log('Yes button reset');
      }

      function clamp(v, min, max) {
        return Math.max(min, Math.min(max, v));
      }

      function moveNoButton() {
        const SAFE_PADDING = 50;
        const vw = window.innerWidth;
        const vh = window.innerHeight;

        const noRect = noBtn.getBoundingClientRect();
        const btnWidth = noRect.width;
        const btnHeight = noRect.height;

        const yesRect = yesBtn.getBoundingClientRect();
        const minDistance = 200;

        const minX = SAFE_PADDING;
        const maxX = vw - btnWidth - SAFE_PADDING;
        const minY = SAFE_PADDING;
        const maxY = vh - btnHeight - SAFE_PADDING;

        if (maxX <= minX || maxY <= minY) return;

        let x, y;
        let tries = 0;

        do {
          x = minX + Math.random() * (maxX - minX);
          y = minY + Math.random() * (maxY - minY);

          const cx = x + btnWidth / 2;
          const cy = y + btnHeight / 2;
          const yx = yesRect.left + yesRect.width / 2;
          const yy = yesRect.top + yesRect.height / 2;

          const dist = Math.hypot(cx - yx, cy - yy);
          tries++;

          if (dist > minDistance || tries >= 30) break;
        } while (tries < 30);

        x = clamp(x, minX, maxX);
        y = clamp(y, minY, maxY);

        noBtn.style.left = `${x}px`;
        noBtn.style.top = `${y}px`;
        noBtn.style.transform = "translate(0,0)";

        growYesButton();
      }

      function placeNoNearButtons() {
        requestAnimationFrame(() => {
          requestAnimationFrame(() => {
            requestAnimationFrame(() => {
              const yesRect = yesBtn.getBoundingClientRect();
              if (yesRect.width === 0 || yesRect.height === 0) {
                setTimeout(placeNoNearButtons, 50);
                return;
              }

              const gap = 14;
              const x = yesRect.right + gap;
              const y = yesRect.top;

              noBtn.style.left = `${Math.round(x)}px`;
              noBtn.style.top = `${Math.round(y)}px`;
              noBtn.style.transform = "translate(0,0)";

              noBtn.style.visibility = 'visible';
              noBtn.style.opacity = '1';
            });
          });
        });
      }

      ["pointerenter", "pointerdown", "mouseover", "touchstart"].forEach((evt) => {
        noBtn.addEventListener(
          evt,
          (e) => {
            e.preventDefault();
            moveNoButton();
            if (evt === "pointerdown" || evt === "touchstart") {
              showToast("Esa opciÃ³n no estÃ¡ disponible ðŸ˜Œ");
            }
          },
          { passive: false }
        );
      });

      noBtn.addEventListener("click", (e) => {
        e.preventDefault();
        moveNoButton();
        showToast("Nop ðŸ˜Œ");
      });

      function spawnHeart() {
        const el = document.createElement("div");
        el.className = "heart";

        const size = 22 + Math.random() * 36;
        const left = Math.random() * window.innerWidth;

        el.style.left = `${left}px`;
        el.style.width = `${size}px`;
        el.style.height = `${size}px`;

        const src = HEART_IMG_URLS[Math.floor(Math.random() * HEART_IMG_URLS.length)];
        el.style.backgroundImage = `url(${src})`;

        el.style.setProperty("--drift", `${(Math.random() * 240 - 120).toFixed(0)}px`);
        el.style.setProperty("--rot", `${(Math.random() * 80 - 40).toFixed(0)}deg`);
        el.style.animationDuration = `${(3.2 + Math.random() * 2.6).toFixed(2)}s`;

        heartsLayer.appendChild(el);
        setTimeout(() => el.remove(), 6500);
      }

      function stopHearts() {
        clearInterval(heartTimer);
        heartTimer = null;
        heartsLayer.innerHTML = "";
      }

      function startHeartsBurst() {
        stopHearts();
        for (let i = 0; i < 22; i++) setTimeout(spawnHeart, i * 25);

        const durationMs = 1100;
        const intervalMs = 75;
        const start = Date.now();

        heartTimer =s = setInterval(() => {
          spawnHeart();
          if (Date.now() - start > durationMs) {
            clearInterval(heartTimer);
            heartTimer = null;
          }
        }, intervalMs);
      }

      function fillDiag(container, urls) {
        if (!container) return;
        container.innerHTML = "";

        const makeImgs = () =>
          urls.map((u, i) => {
            const img = document.createElement("img");
            img.src = u;
            img.alt = `Foto ${i + 1}`;
            img.loading = "lazy";
            return img;
          });

        [...makeImgs(), ...makeImgs()].forEach((img) => container.appendChild(img));
      }

      function showRibbon(urls) {
        if (!ribbonDiag || !ribbonTL || !ribbonBR) return;
        if (!urls || urls.length === 0) return;

        ribbonDiag.classList.remove("hidden");
        ribbonDiag.setAttribute("aria-hidden", "false");

        fillDiag(ribbonTL, urls);
        fillDiag(ribbonBR, urls);
      }

      function hideRibbon() {
        if (!ribbonDiag || !ribbonTL || !ribbonBR) return;

        ribbonTL.innerHTML = "";
        ribbonBR.innerHTML = "";

        ribbonDiag.classList.add("hidden");
        ribbonDiag.setAttribute("aria-hidden", "true");
      }

      function buildPhotoStrip(urls) {
        if (!photoStrip) return;
        if (!urls || urls.length === 0) return;

        photoStrip.classList.remove("hidden");
        photoStrip.setAttribute("aria-hidden", "false");

        const track = document.createElement("div");
        track.className = "track";

        const makeImgs = () =>
          urls.map((u, i) => {
            const img = document.createElement("img");
            img.src = u;
            img.alt = `Foto ${i + 1}`;
            img.loading = "lazy";
            return img;
          });

        [...makeImgs(), ...makeImgs()].forEach((img) => track.appendChild(img));

        photoStrip.innerHTML = "";
        photoStrip.appendChild(track);
      }

      function clearPhotoStrip() {
        if (!photoStrip) return;
        photoStrip.innerHTML = "";
        photoStrip.classList.add("hidden");
        photoStrip.setAttribute("aria-hidden", "true");
      }

      function goYes() {
        stageQ.classList.add("hidden");
        stageY.classList.remove("hidden");

        noBtn.style.visibility = 'hidden';
        noBtn.style.opacity = '0';

        resetYesButton();
        startHeartsBurst();
        showRibbon(PHOTO_URLS);
        buildPhotoStrip(STRIP_URLS);
      }

      function resetAll() {
        stopHearts();
        clearPhotoStrip();
        hideRibbon();

        stageY.classList.add("hidden");
        stageQ.classList.remove("hidden");

        placeNoNearButtons();
        resetYesButton();
      }

      yesBtn.addEventListener("click", goYes);
      restartBtn.addEventListener("click", resetAll);

      window.addEventListener("resize", () => {
        if (!stageQ.classList.contains("hidden")) {
          const vw = window.innerWidth;
          const vh = window.innerHeight;
          const noRect = noBtn.getBoundingClientRect();
          const pad = 50;

          const currentLeft = parseFloat(noBtn.style.left) || 0;
          const currentTop = parseFloat(noBtn.style.top) || 0;

          const newLeft = clamp(currentLeft, pad, vw - noRect.width - pad);
          const newTop = clamp(currentTop, pad, vh - noRect.height - pad);

          noBtn.style.left = `${newLeft}px`;
          noBtn.style.top = `${newTop}px`;
        }
      });

      setTimeout(() => placeNoNearButtons(), 150);
    });
  </script>
</body>
</html>
